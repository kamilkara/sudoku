<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Pro Sudoku - Picker Mode</title>
    <style>
        :root {
            /* Light Theme */
            --bg-body: #f8f9fa;
            --bg-card: #ffffff;
            --text-main: #212529;
            --grid-border: #343a40;
            --cell-border: #dee2e6;
            --thick-weight: 2px; 
            
            /* Highlighting */
            --hl-lane: #e8f0fe; 
            --hl-match: #c2dbff;
            --hl-selected: #7fb5ff;
            --hl-picker: #ffecb3; /* Yellow tint for picker mode */
            
            /* Numbers */
            --val-fixed: #000000;
            --val-user: #0056b3;
            --val-error: #e63946;
        }

        [data-theme='dark'] {
            --bg-body: #121212;
            --bg-card: #1e1e1e;
            --text-main: #e0e0e0;
            --grid-border: #ffffff;
            --cell-border: #333333;
            --hl-lane: #2c3e50;
            --hl-match: #34495e;
            --hl-selected: #1a5fb4;
            --hl-picker: #5d4037;
            --val-fixed: #ffffff;
            --val-user: #4dabf7;
            --val-error: #ff6b6b;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 10px;
            transition: background 0.3s ease;
            user-select: none;
        }

        .header {
            display: flex;
            width: 100%;
            max-width: 450px;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .theme-btn {
            background: none;
            border: 1px solid var(--cell-border);
            color: var(--text-main);
            padding: 5px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Toggle Switch Styling */
        .picker-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 15px;
            background: var(--bg-card);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--cell-border);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 20px;
        }

        .switch input { opacity: 0; width: 0; height: 0; }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 14px; width: 14px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider { background-color: var(--val-user); }
        input:checked + .slider:before { transform: translateX(14px); }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .controls label {
            cursor: pointer;
            font-size: 14px;
            padding: 6px 12px;
            border-radius: 15px;
            background: var(--bg-card);
            border: 1px solid var(--cell-border);
        }

        .controls input:checked + span { color: var(--val-user); font-weight: bold; }

        #grid {
            display: grid;
            grid-template-columns: repeat(9, clamp(35px, 10vw, 50px));
            grid-template-rows: repeat(9, clamp(35px, 10vw, 50px));
            border: var(--thick-weight) solid var(--grid-border);
            background-color: var(--grid-border);
            gap: 1px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .cell {
            background-color: var(--bg-card);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 400;
            cursor: pointer;
        }

        .cell:nth-child(3n) { border-right: var(--thick-weight) solid var(--grid-border); }
        .cell:nth-child(9n) { border-right: none; }
        #grid > div:nth-child(n+19):nth-child(-n+27),
        #grid > div:nth-child(n+46):nth-child(-n+54) {
            border-bottom: var(--thick-weight) solid var(--grid-border);
        }

        .hl-lane { background-color: var(--hl-lane); }
        .hl-match { background-color: var(--hl-match) !important; }
        .selected { background-color: var(--hl-selected) !important; }
        .picker-active { background-color: var(--hl-picker) !important; }

        .readonly { color: var(--val-fixed); font-weight: 700; }
        .user-correct { color: var(--val-user); }
        .user-error { color: var(--val-error); }

        .numpad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 25px;
            width: 100%;
            max-width: 450px;
        }

        .num-btn {
            background: var(--bg-card);
            color: var(--text-main);
            padding: 15px 0;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            border: 1px solid var(--cell-border);
            text-align: center;
            cursor: pointer;
        }

        .num-btn.active-num {
            background-color: var(--val-user);
            color: white;
            border-color: var(--val-user);
        }

        .num-btn:active { transform: scale(0.95); opacity: 0.8; }
        .num-btn.clear { color: var(--val-error); }
    </style>
</head>
<body data-theme="light">

    <div class="header">
        <h2 style="margin:0">Sudoku</h2>
        <button class="theme-btn" onclick="toggleTheme()">ðŸŒ“ Theme</button>
    </div>

    <div class="controls">
        <label><input type="radio" name="diff" value="easy" checked onchange="newGame()"> <span>Normal</span></label>
        <label><input type="radio" name="diff" value="hard" onchange="newGame()"> <span>Hard</span></label>
        <label><input type="radio" name="diff" value="expert" onchange="newGame()"> <span>Expert</span></label>
    </div>

    <div class="picker-toggle">
        <span>Picker Mode</span>
        <label class="switch">
            <input type="checkbox" id="pickerModeToggle" onchange="togglePickerMode()">
            <span class="slider"></span>
        </label>
    </div>

    <div id="grid"></div>

    <div class="numpad">
        <div class="num-btn" id="btn-1" onclick="handleNumInput(1)">1</div>
        <div class="num-btn" id="btn-2" onclick="handleNumInput(2)">2</div>
        <div class="num-btn" id="btn-3" onclick="handleNumInput(3)">3</div>
        <div class="num-btn" id="btn-4" onclick="handleNumInput(4)">4</div>
        <div class="num-btn" id="btn-5" onclick="handleNumInput(5)">5</div>
        <div class="num-btn" id="btn-6" onclick="handleNumInput(6)">6</div>
        <div class="num-btn" id="btn-7" onclick="handleNumInput(7)">7</div>
        <div class="num-btn" id="btn-8" onclick="handleNumInput(8)">8</div>
        <div class="num-btn" id="btn-9" onclick="handleNumInput(9)">9</div>
        <div class="num-btn clear" onclick="handleNumInput(0)">âŒ«</div>
    </div>

    <script>
        let solution = [];
        let selectedCell = null;
        let readonlyMap = []; 
        let isPickerMode = false;
        let heldNumber = null;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function toggleTheme() {
            const current = document.body.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('sudoku_theme', newTheme);
        }

        function togglePickerMode() {
            isPickerMode = document.getElementById('pickerModeToggle').checked;
            heldNumber = null;
            clearHighlights();
            updateNumpadUI();
        }

        function updateNumpadUI() {
            document.querySelectorAll('.num-btn').forEach(btn => btn.classList.remove('active-num'));
            if (isPickerMode && heldNumber) {
                const activeBtn = document.getElementById(`btn-${heldNumber}`);
                if (activeBtn) activeBtn.classList.add('active-num');
            }
        }

        function clearHighlights() {
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('selected', 'hl-lane', 'hl-match', 'picker-active'));
        }

        function saveGame() {
            const currentDigits = Array.from(document.querySelectorAll('.cell')).map(c => c.innerText);
            localStorage.setItem('sudoku_save_data', JSON.stringify({
                solution, puzzleState: currentDigits, readonlyMap,
                difficulty: document.querySelector('input[name="diff"]:checked').value
            }));
        }

        function loadGame() {
            const savedTheme = localStorage.getItem('sudoku_theme');
            if (savedTheme) document.body.setAttribute('data-theme', savedTheme);
            const savedData = localStorage.getItem('sudoku_save_data');
            if (savedData) {
                const data = JSON.parse(savedData);
                solution = data.solution; readonlyMap = data.readonlyMap;
                document.querySelector(`input[name="diff"][value="${data.difficulty}"]`).checked = true;
                renderSaved(data.puzzleState);
                return true;
            }
            return false;
        }

        function playSound(freq) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine'; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        function newGame() {
            const diff = document.querySelector('input[name="diff"]:checked').value;
            const clues = diff === 'easy' ? 36 : diff === 'hard' ? 26 : 19;
            let board = Array.from({length: 9}, () => Array(9).fill(0));
            solve(board); solution = JSON.parse(JSON.stringify(board));
            readonlyMap = Array(81).fill(false);
            let removed = 0;
            while(removed < (81 - clues)) {
                let r = Math.floor(Math.random()*9), c = Math.floor(Math.random()*9);
                if(board[r][c] !== 0) { board[r][c] = 0; removed++; }
            }
            board.flat().forEach((val, i) => { if(val !== 0) readonlyMap[i] = true; });
            renderSaved(board.flat().map(v => v === 0 ? "" : v.toString()));
            saveGame();
        }

        function solve(board) {
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    if (board[r][c] === 0) {
                        let nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
                        for (let n of nums) {
                            if (check(board, r, c, n)) {
                                board[r][c] = n;
                                if (solve(board)) return true;
                                board[r][c] = 0;
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        function check(b, r, c, k) {
            for (let i = 0; i < 9; i++) {
                const m = 3 * Math.floor(r / 3) + Math.floor(i / 3);
                const n = 3 * Math.floor(c / 3) + i % 3;
                if (b[r][i] == k || b[i][c] == k || b[m][n] == k) return false;
            }
            return true;
        }

        function renderSaved(flatDigits) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            flatDigits.forEach((val, i) => {
                const div = document.createElement('div');
                div.className = 'cell';
                div.dataset.r = Math.floor(i / 9); div.dataset.c = i % 9;
                div.innerText = val;
                if (readonlyMap[i]) div.classList.add('readonly');
                else if (val !== "") div.classList.add(val == solution[div.dataset.r][div.dataset.c] ? 'user-correct' : 'user-error');
                div.onclick = () => onCellClick(div);
                grid.appendChild(div);
            });
        }

        function onCellClick(cell) {
            if (isPickerMode) {
                if (cell.classList.contains('readonly')) {
                    // Pick the number from a fixed cell
                    heldNumber = parseInt(cell.innerText);
                    updateNumpadUI();
                    highlight(cell);
                } else if (heldNumber !== null) {
                    // Fill an empty/user cell with the held number
                    inputNumberIntoCell(cell, heldNumber);
                } else {
                    highlight(cell);
                }
            } else {
                highlight(cell);
            }
        }

        function highlight(cell) {
            clearHighlights();
            selectedCell = cell;
            cell.classList.add('selected');
            const r = cell.dataset.r, c = cell.dataset.c, val = cell.innerText;
            document.querySelectorAll('.cell').forEach(item => {
                if (item.dataset.r === r || item.dataset.c === c) item.classList.add('hl-lane');
                if (val && item.innerText === val) item.classList.add('hl-match');
            });
        }

        function handleNumInput(n) {
            if (isPickerMode) {
                heldNumber = n === 0 ? null : n;
                updateNumpadUI();
            } else if (selectedCell) {
                inputNumberIntoCell(selectedCell, n);
            }
        }

        function inputNumberIntoCell(cell, n) {
            if (cell.classList.contains('readonly')) return;
            const r = cell.dataset.r, c = cell.dataset.c;
            if (n === 0) {
                cell.innerText = '';
                cell.classList.remove('user-correct', 'user-error');
                playSound(200);
            } else {
                cell.innerText = n;
                const correct = (n == solution[r][c]);
                cell.classList.remove('user-correct', 'user-error');
                cell.classList.add(correct ? 'user-correct' : 'user-error');
                playSound(correct ? 600 : 150);
            }
            highlight(cell);
            saveGame();
        }

        if (!loadGame()) newGame();
    </script>
</body>
</html>
